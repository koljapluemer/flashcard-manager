{% extends 'base.html' %}

{% block title %}Curricula{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Curricula</h1>
    <a href="{% url 'curriculum_create' %}" class="btn btn-primary">+ New Curriculum</a>
</div>

{% if curricula %}
    <div class="space-y-2">
        {% for curriculum in curricula %}
        <div class="collapse collapse-arrow bg-base-200">
            <input type="checkbox" name="curriculum-{{ curriculum.id }}" />
            <div class="collapse-title text-xl font-medium flex items-center justify-between pr-12">
                <span>{{ curriculum.name }}</span>
                <div class="flex gap-2 z-10">
                    <a href="{% url 'subject_create' curriculum.id %}" class="btn btn-sm btn-ghost" onclick="event.stopPropagation()">+ Subject</a>
                    <a href="{% url 'curriculum_edit' curriculum.id %}" class="btn btn-sm btn-ghost" onclick="event.stopPropagation()">Edit</a>
                    <a href="{% url 'curriculum_delete' curriculum.id %}" class="btn btn-sm btn-ghost text-error" onclick="event.stopPropagation()">Delete</a>
                </div>
            </div>
            <div class="collapse-content">
                {% if curriculum.description %}
                    <p class="text-sm opacity-70 mb-4">{{ curriculum.description }}</p>
                {% endif %}

                {% if curriculum.subjects.all %}
                    <div class="ml-4 space-y-2">
                        {% for subject in curriculum.subjects.all %}
                        <div class="collapse collapse-arrow bg-base-300">
                            <input type="checkbox" name="subject-{{ subject.id }}" />
                            <div class="collapse-title font-medium flex items-center justify-between pr-12">
                                <span>{{ subject.name }}</span>
                                <div class="flex gap-2 z-10">
                                    <a href="{% url 'topic_create' subject.id %}" class="btn btn-xs btn-ghost" onclick="event.stopPropagation()">+ Topic</a>
                                    <a href="{% url 'subject_edit' subject.id %}" class="btn btn-xs btn-ghost" onclick="event.stopPropagation()">Edit</a>
                                    <a href="{% url 'subject_delete' subject.id %}" class="btn btn-xs btn-ghost text-error" onclick="event.stopPropagation()">Delete</a>
                                </div>
                            </div>
                            <div class="collapse-content">
                                {% if subject.description %}
                                    <p class="text-sm opacity-70 mb-4">{{ subject.description }}</p>
                                {% endif %}

                                {% if subject.topics.all %}
                                    <div class="ml-4 space-y-2">
                                        {% for topic in subject.topics.all %}
                                        <div class="collapse collapse-arrow bg-base-100">
                                            <input type="checkbox" name="topic-{{ topic.id }}" />
                                            <div class="collapse-title text-sm font-medium flex items-center justify-between pr-12">
                                                <span>{{ topic.name }}</span>
                                                <div class="flex gap-2 z-10">
                                                    <a href="{% url 'collection_create_for_topic' topic.id %}" class="btn btn-xs btn-ghost" onclick="event.stopPropagation()">+ Collection</a>
                                                    <a href="{% url 'topic_edit' topic.id %}" class="btn btn-xs btn-ghost" onclick="event.stopPropagation()">Edit</a>
                                                    <a href="{% url 'topic_delete' topic.id %}" class="btn btn-xs btn-ghost text-error" onclick="event.stopPropagation()">Delete</a>
                                                </div>
                                            </div>
                                            <div class="collapse-content">
                                                {% if topic.description %}
                                                    <p class="text-xs opacity-70 mb-4">{{ topic.description }}</p>
                                                {% endif %}

                                                {% if topic.collections.all %}
                                                    <div class="ml-4">
                                                        <h4 class="text-xs font-semibold mb-2">Collections:</h4>
                                                        <ul class="space-y-1">
                                                            {% for collection in topic.collections.all %}
                                                            <li class="text-xs">
                                                                <a href="{% url 'collection_detail' collection.id %}" class="link link-hover">{{ collection.title }}</a>
                                                                {% if collection.description %}
                                                                    <span class="opacity-60"> - {{ collection.description|truncatewords:10 }}</span>
                                                                {% endif %}
                                                            </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </div>
                                                {% else %}
                                                    <p class="text-xs opacity-50 ml-4">No collections yet</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-sm opacity-50 ml-4">No topics yet</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-sm opacity-50 ml-4">No subjects yet</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-12">
        <p class="text-lg opacity-60">No curricula yet. Create your first curriculum to get started.</p>
    </div>
{% endif %}
{% endblock %}
